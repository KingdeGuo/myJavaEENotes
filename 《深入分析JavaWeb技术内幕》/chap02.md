# 深入分析java I/O的工作机制

- I/O问题是核心：数据格式、传输方式。（将什么样的数据写到什么地方）
- 分类
  - 字节操作：InputStream，OutputStream
  - 字符操作：Writer，Reader
  - 磁盘操作：File
  - 网络操作：Socket
- 不管是磁盘还是网络传输，最小的存储单元都是字节，而不是字符。所以I/O操作的都是字节而不是字符。
- 读和写分别使用`read()`和`write()`系统调用来完成。只要是系统调用就可能会存在内核空间地址和用户空间地址切换的问题。为了加速I/O访问，在内核空间使用缓存机制。
- 几种文件访问方式
  - 标准访问文件的方式
    - `read()`
      - 如果缓存有，则直接读缓存。
      - 如果没有，则从磁盘中读取，然后缓存在操作系统的缓存中。
    - `write()`:
      - 将数据从用户地址空间复制到内核地址空间的缓存中（此时对用户来说，写操作已完成）
      - 由操作系统决定什么时候写到磁盘中。除非显式调用`sync`指令。
  - 直接的I/O方式
    - 减少一次内核缓冲到用户程序缓冲的数据复制。这种访问文件的方式通常是在对数据的缓存管理由应用程序实现的数据库管理系统中。
    - 可以对热点数据做预加载。
    - 如果出现访问的数据不在应用程序缓存中，那么每次数据都会直接从磁盘加载，这种加载会非常缓慢。
  - 同步访问文件的方式
    - 写入和读取都是同步操作的。
    - 性能比较差，安全性比较高。
  - 异步访问文件的方式
    - 可以提高应用程序的效率，但不会提高访问文件的效率。
  - 内存映射的方式
    - 操作系统中某一块区域与磁盘中的文件关联起来，当要访问内存中的一段数据时，转化为访问文件的某一段数据。
- 数据在磁盘中的唯一最小描述就是文件。
- Java序列化技术就是将一个对象转化为一串二进制表示的字节数组，通过保存或转移这些字节数据来达到持久化的目的。
  - 如果要持久化
    - 继承`serializable`接口
    - 有原始类作为模板，才能进行还原
    - 在纯Java环境下，Java序列化可以比较好的工作，但是在多语言环境下，推荐通用的存储结构，例如Google的protobuf。
- 